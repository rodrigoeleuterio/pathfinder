# Use the latest 2.1 version of CircleCI pipeline processing engine, see https://circleci.com/docs/2.0/configuration-reference/
version: 2.1

jobs:
  build:
    docker:
      - image: mcr.microsoft.com/dotnet/core/sdk:2.2

    steps:
      - checkout
      
      - run:
          name: Restore Packages
          command: 
              dotnet restore
      
      - run:
          name: Build
          command: 
              dotnet build
      
      - run:
          name: Run Tests
          command: |
              dotnet test --no-build --logger "trx"
              dotnet tool install -g trx2junit
              export PATH="$PATH:/root/.dotnet/tools"
              trx2junit tests/**/TestResults/*.trx
      
      - run:
          name: Run Terminal App
          command: 
              dotnet run -p app-terminal
                     
      - store_test_results:
          path: tests/TestResults
          
      - store_artifacts:
          path: tests/TestResults
          destination: TestResults